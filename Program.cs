using System;
using System.Linq; 
using System.Collections.Generic;

namespace LabWork
{
    // –î–∞–Ω–∏–π –ø—Ä–æ–µ–∫—Ç —î —à–∞–±–ª–æ–Ω–æ–º –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∏—Ö —Ä–æ–±—ñ—Ç

    /// <summary>
    /// –ö–ª–∞—Å, —â–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω—É –ü—Ä–æ–≥—Ä–µ—Å—ñ—é.
    /// –•–∞—Ä–∞–∫—Ç–µ—Ä–∏–∑—É—î—Ç—å—Å—è –ø–µ—Ä—à–∏–º —á–ª–µ–Ω–æ–º (a0), —Ä—ñ–∑–Ω–∏—Ü–µ—é (d) —Ç–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—é —á–ª–µ–Ω—ñ–≤ (n).
    /// </summary>
    public class ArithmeticProgression // PascalCase —Ç–∞ —è–≤–Ω–∏–π public
    {
        // –ü—Ä–∏–≤–∞—Ç–Ω—ñ –ø–æ–ª—è (—ñ–Ω–∫–∞–ø—Å—É–ª—è—Ü—ñ—è)
        private readonly double _first;
        private readonly double _difference;
        private readonly int _count;

        // –ü—É–±–ª—ñ—á–Ω—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ (PascalCase) –ª–∏—à–µ –¥–ª—è —á–∏—Ç–∞–Ω–Ω—è
        public double First => _first;
        public double Difference => _difference;
        public int Count => _count;

        /// <summary>
        /// –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–æ—ó –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó.
        /// </summary>
        /// <param name="a0">–ü–µ—Ä—à–∏–π —á–ª–µ–Ω –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó (double).</param>
        /// <param name="d">–†—ñ–∑–Ω–∏—Ü—è –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó (double).</param>
        /// <param name="n">–ö—ñ–ª—å–∫—ñ—Å—Ç—å —á–ª–µ–Ω—ñ–≤ –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó (int). –ú–∞—î –±—É—Ç–∏ > 0.</param>
        public ArithmeticProgression(double a0, double d, int n)
        {
            // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤—Ö–æ–¥—É: –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞, —â–æ Count > 0
            if (n <= 0)
            {
                throw new ArgumentException("–ö—ñ–ª—å–∫—ñ—Å—Ç—å —á–ª–µ–Ω—ñ–≤ (Count) –ø–æ–≤–∏–Ω–Ω–∞ –±—É—Ç–∏ –±—ñ–ª—å—à–æ—é –∑–∞ –Ω—É–ª—å.", nameof(n));
            }

            _first = a0;
            _difference = d;
            _count = n;
        }

        /// <summary>
        /// –û–±—á–∏—Å–ª—é—î —Å—É–º—É –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–æ—ó –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó –∑–∞ —Ñ–æ—Ä–º—É–ª–æ—é: S = n*(2*a0 + (n-1)*d)/2.
        /// </summary>
        /// <returns>–°—É–º–∞ n —á–ª–µ–Ω—ñ–≤ –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó (double).</returns>
        public double Sum() // PascalCase
        {
            // –§–æ—Ä–º—É–ª–∞ —Å—É–º–∏ –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–æ—ó –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó
            double sum = (double)_count * (2 * _first + (_count - 1) * _difference) / 2;
            return sum;
        }

        /// <summary>
        /// –ü–µ—Ä–µ–≤–∏–∑–Ω–∞—á–µ–Ω–∏–π –º–µ—Ç–æ–¥ –¥–ª—è —á–∏—Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –≤–∏–≤–æ–¥—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó —Ç–∞ —ó—ó —Å—É–º–∏.
        /// </summary>
        /// <returns>–†—è–¥–æ–∫ —ñ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó —Ç–∞ –æ–±—á–∏—Å–ª–µ–Ω–æ—é —Å—É–º–æ—é.</returns>
        public override string ToString()
        {
            return $"A.P.: First (a0)={First:F2}, Difference (d)={Difference:F2}, Count (n)={Count}, Sum={Sum():F2}";
        }
    }

    // –ö–ª–∞—Å Result –∑–∞–ª–∏—à–∞—î–º–æ –ø–æ—Ä–æ–∂–Ω—ñ–º, —è–∫ —É –ø–æ—á–∞—Ç–∫–æ–≤–æ–º—É —à–∞–±–ª–æ–Ω—ñ
    class Result
    {
        // TODO: do it !
    }

    // –ö–ª–∞—Å Program –º–æ–∂–µ –±—É—Ç–∏ —Å—Ç–∞—Ç–∏—á–Ω–∏–º —É .NET Core 6+ –¥–ª—è —Å–ø—Ä–æ—â–µ–Ω–Ω—è, 
    // –∞–ª–µ –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ —Ç–∞ —Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è —à–∞–±–ª–æ–Ω—É –∑–∞–ª–∏—à–∞—î–º–æ –π–æ–≥–æ –∑–≤–∏—á–∞–π–Ω–∏–º.
    public class Program
    {
        /// <summary>
        /// –î–æ–ø–æ–º—ñ–∂–Ω–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è double –∑ –∫–æ–Ω—Å–æ–ª—ñ, –æ–±—Ä–æ–±–ª—è—é—á–∏ –ø–æ–º–∏–ª–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥—É.
        /// </summary>
        private static double ReadDouble(string prompt)
        {
            double value; // camelCase –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö
            Console.Write(prompt);
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É –≤–≤–æ–¥—É
            while (!double.TryParse(Console.ReadLine(), out value))
            {
                Console.WriteLine("–ü–æ–º–∏–ª–∫–∞ –≤–≤–æ–¥—É. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –¥—ñ–π—Å–Ω–µ —á–∏—Å–ª–æ.");
                Console.Write(prompt);
            }
            return value;
        }

        /// <summary>
        /// –î–æ–ø–æ–º—ñ–∂–Ω–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∑—á–∏—Ç—É–≤–∞–Ω–Ω—è int –∑ –∫–æ–Ω—Å–æ–ª—ñ, –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏, —â–æ n > 0.
        /// </summary>
        private static int ReadInt(string prompt)
        {
            int value; // camelCase
            Console.Write(prompt);
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É —Ç–∞ –≥—Ä–∞–Ω–∏—á–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å (n > 0)
            while (!int.TryParse(Console.ReadLine(), out value) || value <= 0)
            {
                Console.WriteLine("–ü–æ–º–∏–ª–∫–∞ –≤–≤–æ–¥—É. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å —Ü—ñ–ª–µ —á–∏—Å–ª–æ, –ë–Ü–õ–¨–®–ï –∑–∞ 0.");
                Console.Write(prompt);
            }
            return value;
        }

        /// <summary>
        /// –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É –≤ –ø—Ä–æ–≥—Ä–∞–º—É.
        /// </summary>
        public static void Main(string[] args)
        {
            Console.OutputEncoding = System.Text.Encoding.UTF8;
            Console.WriteLine("--- üöÄ –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞: –ê—Ä–∏—Ñ–º–µ—Ç–∏—á–Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—ñ—è (–ü–æ—à—É–∫ Max –°—É–º–∏) ---");
            Console.WriteLine("-------------------------------------------------------------------");

            // 1. –ü—Ä–æ—á–∏—Ç–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä –º–∞—Å–∏–≤—É (–∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—ñ–π)
            int progressionCount = 0;
            try
            {
                progressionCount = ReadInt("–í–≤–µ–¥—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—ñ–π (m > 0): ");
            }
            catch (Exception)
            {
                 // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ –Ω–µ–æ–±—Ä–æ–±–ª–µ–Ω–∏–º –≤–∏–∫–ª—é—á–µ–Ω–Ω—è–º –Ω–∞ —Ä—ñ–≤–Ω—ñ Main
                 Console.WriteLine("–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—ñ–π –Ω–µ –±—É–ª–∞ –≤–≤–µ–¥–µ–Ω–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ. –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è.");
                 return;
            }
            
            // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è List –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤
            var progressions = new List<ArithmeticProgression>();
            
            // 2. –ù–∞–ø–æ–≤–Ω–µ–Ω–Ω—è –º–∞—Å–∏–≤—É/—Å–ø–∏—Å–∫—É, —á–∏—Ç–∞—é—á–∏ a0, d, n –¥–ª—è –∫–æ–∂–Ω–æ—ó –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó
            for (int i = 0; i < progressionCount; i++)
            {
                Console.WriteLine($"\n--- –í–≤–µ–¥–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó #{i + 1} ---");
                try
                {
                    double a0 = ReadDouble($"–í–≤–µ–¥—ñ—Ç—å –ø–µ—Ä—à–∏–π —á–ª–µ–Ω a0: ");
                    double d = ReadDouble($"–í–≤–µ–¥—ñ—Ç—å —Ä—ñ–∑–Ω–∏—Ü—é d: ");
                    int n = ReadInt($"–í–≤–µ–¥—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å —á–ª–µ–Ω—ñ–≤ n (n > 0): ");
                    
                    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç–∞
                    progressions.Add(new ArithmeticProgression(a0, d, n));
                }
                catch (ArgumentException ex)
                {
                    // –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ (—è–∫—â–æ ReadInt –Ω–µ —Å–ø—Ä–∞—Ü—é–≤–∞–≤, –∞–±–æ —ñ–Ω—à–∞ –ø–æ–º–∏–ª–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó)
                    Console.WriteLine($"–ü–æ–º–∏–ª–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó: {ex.Message}. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó #{i + 1} –ø—Ä–æ–ø—É—â–µ–Ω–æ.");
                }
            }
            
            Console.WriteLine("\n-------------------------------------------------------------------");
            Console.WriteLine($"–ó–±–µ—Ä–µ–∂–µ–Ω–æ {progressionCount} –ø—Ä–æ–≥—Ä–µ—Å—ñ–π. –û–±—á–∏—Å–ª–µ–Ω–Ω—è —Å—É–º...");

            if (progressionCount == 0 || progressions.Count == 0)
            {
                Console.WriteLine("–ù–µ–º–∞—î –ø—Ä–æ–≥—Ä–µ—Å—ñ–π –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É.");
                return;
            }

            // 3. –ü–æ—à—É–∫ –ø—Ä–æ–≥—Ä–µ—Å—ñ—ó –∑ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—é —Å—É–º–æ—é (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ LINQ)
            // –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è LINQ.OrderByDescending().First() —î —á–∏—Å—Ç–∏–º —ñ —Å—É—á–∞—Å–Ω–∏–º —Å–ø–æ—Å–æ–±–æ–º –¥–ª—è .NET 5.0.
            ArithmeticProgression maxSumProgression = progressions
                .OrderByDescending(p => p.Sum()) // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ —Å–ø–∞–¥–∞–Ω–Ω—è–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –º–µ—Ç–æ–¥—É Sum()
                .FirstOrDefault();                // –ë–µ—Ä–µ–º–æ –ø–µ—Ä—à–∏–π –µ–ª–µ–º–µ–Ω—Ç

            // 4. –í–∏–≤–µ–¥–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
            Console.WriteLine("\n-------------------------------------------------------------------");
            if (maxSumProgression != null)
            {
                Console.WriteLine("üèÜ –ü–†–û–ì–†–ï–°–Ü–Ø –ó –ù–ê–ô–ë–Ü–õ–¨–®–û–Æ –°–£–ú–û–Æ:");
                Console.WriteLine(maxSumProgression.ToString());
            }
            
            Console.WriteLine("\n--- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–∏ ---");
        }
    }
}
